<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Azure Arch Scraper UI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 20px; }
      button { padding: 8px 12px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; }
      input, select { padding: 8px; border: 1px solid #ddd; border-radius: 8px; }
      .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; margin-bottom: 12px; }
      .card { border: 1px solid #eee; border-radius: 12px; padding: 14px; margin: 8px 0; }
      .muted { color: #666; font-size: 0.9em; }
      .badge { background: #f2f4f7; border: 1px solid #e5e7eb; border-radius: 999px; padding: 2px 8px; margin-right: 6px; font-size: 12px; }
      .error { color: #b91c1c; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- React from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script>
      const { useState } = React;
      const API = "http://localhost:8000"; // your FastAPI container

      function App() {
        const [limit, setLimit] = useState(6);
        const [save, setSave] = useState(true);
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState("");
        const [items, setItems] = useState([]);
        const [mode, setMode] = useState("saved");

        async function doScrape() {
          setLoading(true); setError(""); setMode("scrape");
          try {
            const res = await fetch(API + "/scrape", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ limit: Number(limit), save })
            });
            if (!res.ok) throw new Error(await res.text());
            setItems(await res.json());
          } catch (e) {
            setError(e.message || String(e));
          } finally { setLoading(false); }
        }

        async function loadSaved() {
          setLoading(true); setError(""); setMode("saved");
          try {
            const res = await fetch(API + `/architectures?limit=${encodeURIComponent(limit)}`);
            if (!res.ok) throw new Error(await res.text());
            setItems(await res.json());
          } catch (e) {
            setError(e.message || String(e));
          } finally { setLoading(false); }
        }

        return (
          React.createElement("div", null,
            React.createElement("h1", null, "Azure Architecture Scraper"),
            React.createElement("div", { className: "row" },
              React.createElement("label", null, "Limit"),
              React.createElement("input", { type: "number", min: 1, max: 50, value: limit, onChange: e => setLimit(e.target.value) }),
              React.createElement("label", null, "Save results"),
              React.createElement("select", { value: save ? "true" : "false", onChange: e => setSave(e.target.value === "true") },
                React.createElement("option", { value: "true" }, "true"),
                React.createElement("option", { value: "false" }, "false")
              ),
              React.createElement("button", { onClick: doScrape, disabled: loading }, loading && mode==="scrape" ? "Scraping..." : "Scrape now"),
              React.createElement("button", { onClick: loadSaved, disabled: loading }, loading && mode==="saved" ? "Loading..." : "Load saved")
            ),
            React.createElement("div", { className: "muted" },
              "API: ", API, " • Mode: ", mode === "scrape" ? "live scrape" : "saved from Mongo"
            ),
            error && React.createElement("div", { className: "error" }, error),
            items.length === 0 && !loading && React.createElement("div", { className: "muted" }, "No items to show."),
            items.map((it, idx) =>
              React.createElement("div", { className: "card", key: idx },
                React.createElement("div", { style: { display: "flex", justifyContent: "space-between", gap: 12, flexWrap: "wrap" } },
                  React.createElement("strong", null, it.name || "(no name)"),
                  React.createElement("span", { className: "muted" }, (it.repo || "repo?"), " • ", (it.template_file || ""))),
                it.description && React.createElement("div", { className: "muted", style: { margin: "8px 0" } }, it.description),
                React.createElement("div", null,
                  (it.services || []).slice(0, 10).map(s =>
                    React.createElement("span", { className: "badge", key: s }, s)
                  ),
                  (it.services || []).length > 10 && React.createElement("span", { className: "badge" }, `+${it.services.length - 10} more`)
                ),
                React.createElement("div", { className: "muted", style: { marginTop: 8 } },
                  it.source_urls?.template_html
                    ? React.createElement("a", { href: it.source_urls.template_html, target: "_blank", rel: "noreferrer" }, "View template")
                    : null,
                  " ",
                  it.source_urls?.dir_html
                    ? React.createElement("a", { href: it.source_urls.dir_html, target: "_blank", rel: "noreferrer", style: { marginLeft: 8 } }, "View folder")
                    : null
                )
              )
            )
          )
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
    </script>
  </body>
</html>
